# EasyCredit Widget Integration Guide

This guide provides instructions on how to integrate and display the EasyCredit widget within your application.

## Table of Contents

- [Step 1: Configure Widget Settings](#step-1-configure-widget-settings)
- [Step 2: Initialize and Display the Widget](#step-2-initialize-and-display-the-widget)
- [Step 3: Troubleshooting](#step-4-handling-widget-events)

## Step 1: Configure Widget Settings

- First, after install the connector into the shop, you must config all the necessary credentials that defined in the processor part, you can have a look at [this file](../connect.yaml)
- To display the EasyCredit Widget, which mostly been used in the PDP of every shop, you need to make sure that the `WEBSHOP_ID` is set up correctly and the `WIDGET_ENABLED` is set to be `1`

## Step 2: Initialize and Display the Widget

- We provide you a way to initialize the Widget easily just with a short Javascript script. You can have a look at the [demo file](../enabler/index.html). Here is the short descriptions for the steps:
  - First, you have to import our enabler and initialize it
  ```
    <script type="module">

      import { Enabler } from "/src/main.ts";

      const enabler = new Enabler({
        processorUrl: __VITE_PROCESSOR_URL__,
        sessionId: sessionId,
        amount: 500,
        cartId: testCartId,

        showPayButton: false,
        dropinHasSubmit: true,
        onComplete: ({ isSuccess, paymentReference }) => {
          console.log("onComplete", { isSuccess, paymentReference });
        },
        onError: (err) => {
          console.error("onError", err);
        },
        onDropinReady: () => {
          console.log('dropin is ready');
        },
        onPayButtonClick: () => {
          console.log('pay button handler');
        }
      });
    </script>
  ```

  - There are many configuration needed to initialize it, but to be able to use the EasyCredit Widget, we can just care about the `proccesorUrl`, `sessionId`, and `amount`
    - `processorUrl` (string): The URL of the processor, provided by CommerceTools after installing the connector into your shop.
    - `sessionId` (string): A unique ID generated by CommerceTools for authentication. It ensures that the caller matches the one configured in the processor (which requires settings like `CTP_PROJECT_KEY`, `CTP_AUTH_URL`, etc.). For demo purposes, it is currently generated in [session.js](../enabler/dev-utils/session.js), but in production, you should securely implement this process by authenticating with CommerceTools and obtaining a session ID from their endpoint.
    - `amount` (number): The amount to be displayed in the EasyCredit Widget.
  
  - After initializing successfully, you will need to do these following steps to render it to your page:
    ```
      const dropinBuilder = await enabler.createDropinBuilder('embedded');
      const pdpWdiget = await dropinBuilder.build();

      pdpWdiget.mount("#container");
    ```

    - In general, when the `mount()` being called, the Enabler will call a Processor endpoint to check the value of configured `WEBSHOP_ID` and `WIDGET_ENABLED`:
      - If the `WIDGET_ENABLED` is `1`, then you are allowed to render the component, the component will be rendered in your specified element.
      - If the `WIDGET_ENABLED` is `0`, then there will be nothing rendered in your specified element.

    
## Step 3: Troubleshooting
  - When integrating, if any unexpected behavior occurs, check the Console tab in Dev Tools for errors that may assist in troubleshooting.

